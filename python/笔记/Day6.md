# 异常

## 一、什么是异常

Python语言用异常对象来表示异常情况。当遇到错误后，会引发异常。如果异常对象没有处理异常，或未捕获异常，程序就会终止进行，并向用户返回异常信息。

在捕获异常时，可以选择用同一个代码块处理所有的异常，也可以每一个代码块处理一个异常。之所以可以单独对某一个异常进行处理，是因为每一个异常就是一个类。抛出异常的过程也就是创建这些类的实例的过程。

## 二、主动抛出异常

### 1、raise语句

使用raise语句可以直接抛出异常。raise语句可以使用一个类（必须为Exception类或其子类）或异常对象抛出异常。如果使用类，系统会自动创建类的实例。

```python
raise Exception  #主动抛出异常

raise Exception("这是自己主动抛出的一个异常")  #可以人工加上信息描述

#可以描述特定类型的异常
raise ArithmeticError("这是一个和数值有关的异常")
```



### 2、自定义异常类

很多时候需要自定义异常类。任何一个异常类必须是Exception的子类。最简单的自定义异常类就是一个空的Exception类的子类。

```python
class MyException(Exception);
    pass
```

例子：如何抛出自定义异常

```python
#定义曲速引擎过载类的异常
class WarpdriveOverloadException(Exception):
    pass

#当前曲速值
warpSpeed = 12
if warpSpeed >= 10:
    #抛出自定义异常
    raise WarpdriveOverloadException("曲速引擎已经过载")
```



## 三、捕捉异常

如果异常未捕捉，系统就会一直将异常传递下去，直到程序由于异常而导致中断。为了尽可能避免出现这种程序异常中断的情况，需要对“危险代码段”进行异常捕捉。

### 1、try...except语句的基本用法

try except语句用于捕捉代码块的异常。

例子：try except解决除0错误

```python
x = None #先定义一个x变量，但x变量中没有值
while True:
    try:
        #如果x已经有了值，表示已经捕捉了异常，那么再次输入数据时，就不需要输入x的值了
        if x == None :
            x = int(input("请输入分子"))
        y=int(input("请输入分母"))
        print("x/y={}".format(x/y)) 
        break    #如果分子分母正常，那么退出循环
    except:
        print("分母不能为0，请重新输入")
```

**try except 语句的如下几方面内容**：

（1）try except语句是一个代码块，所以try和except后面都要加冒号

（2）try和except之间是正常执行的语句，如果这些代码不发生错误，那么就会正常执行下去，这时except部分的代码是不会执行的。如果try和except之间的代码发生了错误，那么错误点后面的代码都不会被执行了，而会跳到except子句后执行except代码块中的代码。

（3）如果except关键词后面没有指定任何异常类，那么except部分可以捕捉任何的异常。

### 2、捕捉多个异常

我们并不能预估一个代码块到底会抛出多少种异常，所以要用try except语句捕捉尽可能多的异常，因此，except子句可以包含任意多个。

```python
try:
    #...
except 异常类1:
    #...
except 异常类2:
    #...
except :    #捕捉其他未指定的异常
    #...
```



### 3、用同一个代码块处理多个异常

```python
try:
    #....
except (异常1,异常2...):
    #...
```



### 4、捕捉对象

为了更进一步体现异常的差异性，需要为异常类执行一个变量，也可以称为异常对象。

为异常对象指定名字需要用as关键字

```python
try:
    #...
except 异常类 as e:
    #...
except (异常类1,异常类2,...) as e:
    #...
    
#如果使用print函数输出e，会将通过构造方法参数传给异常对象的异常信息输出到Console
```



### 5、异常捕捉中的else子句

```python
try:
    #...
except:
    #抛出异常时执行这段代码
else:
    #未抛出异常时执行这段代码
```



### 6、异常捕捉中的finally子句

所有需要收尾的代码都要放到finally子句中。不管是正常执行，还是抛出异常，最后都会执行finally子句中代码。例如：在finally子句中放置关闭资源的代码（关闭文件、关闭数据库）

```python
try:
    #...
except:
    #...
finally:
    #无论是否抛出异常，都会执行finally中的代码
    #...
```









## 四、异常、函数与栈跟踪

如果异常被隐藏的很深，而且又不被处理，这种异常是不太好处理的，不过python解析器可以利用栈进行跟踪。例如：当多个函数进行调用时，如果最里层的函数抛出一个异常，而且没有得到处理，那么这个异常会一直进行传播，直到传播到顶层函数，并让程序异常中断。



```python
def fun1():
    raise Exception("fun1抛出的异常")
def fun2():
    fun1()
def fun3():
    fun2()
def fun4():
    fun3()
    
fun4()    #调用fun4函数会抛出异常
```



## 五、异常的使用

在合适的地方使用异常，会让程序更简单，更容易理解。